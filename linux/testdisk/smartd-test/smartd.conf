# Sample configuration file for smartd.  See man smartd.conf.

# Home page is: http://www.smartmontools.org


################################
# v. 1.03 от 06.10.2019 с полной проверкой smart 1 раз в месяц. В пятницу (5-й день) с 14 по 20 число месяца, между 22-23 часов. Это вторая или третья пятница месяца.

# Кодировка файла должна быть Windows-1251 (ANSI)

# Вставить в НАЧАЛО /etc/smartd.conf
# Брал с
# https://kamaok.org.ua/?p=389
# https://wiki.archlinux.org/index.php/S.M.A.R.T.#Notifying_potential_problems 
# https://proft.me/2012/02/10/smartd-monitoring-sostoyaniya-zhestkogo-diska/ 

# КОРОТКИЙ ТЕСТ КОНФИГА:
# Для проверки в /etc/smartd.conf раскомментируем DEVICESCAN … -M test, выполним service smartd restart, если письмо пришло, то закоментируем обратно, 
# выполним smartd -c /etc/smartd.conf -q onecheck , убедимся, что ошибок нет, перезапускаем службу service smartd restart


# ПОЛНЫЙ ТЕСТ КОНФИГА:
# Используем разово для проверки отправки сообщений, после проверки обратно закоментируем, а рабочую строку настройки (ниже), наоборот раскоментируем
# Для проверки конфига выполняем:
# smartd -c /etc/smartd.conf -q onecheck
# Ошибок быть не должно и на почту должны прийти тестовые письма
#
# Если ошибок нет, и письма пришли, то ТЕСТОВУЮ СТРОКУ комментируем, а рабочую строку раскомментируем
# Cохраняем файл. Выполняем:
# smartd -c /etc/smartd.conf -q onecheck
# smartd -c /etc/smartd.conf -q showtests
# 
# Если ошибок нет, то перезапускаем службу
# service smartd restart
# 
# Примечание! Вписываем сюда адрес почты. К сожалению переменные использовать в конфиге нельзя ($ALERTSMAIL), поэтому пишем саму почту, а не переменную $ALERTSMAIL .
# ТЕСТОВАЯ СТРОКА. ПОСЛЕ ПОЛУЧЕНИЯ ТЕСТОВЫХ ПИСЕМ SMART КОММЕНТИРУЕМ! УВЕДОМЛЕНИЯ НА ПОЧТУ РАБОТАЮТ!
##### DEVICESCAN -o on -S on -a -s (S/../.././02|L/../(14|15|16|17|18|19|20)/5/22) -m alerts@ztime.ru -M exec /usr/share/smartmontools/smartd-runner -M diminishing -M test




# Рабочая строка настройки smart:
# - Настройка мониторинга и уведомлений на e-mail (в случае возникновения проблем отправит письмо на почту)
# - Выполнять короткий тест каждый день между 2-3 ночи. 
# - Выполнять полный тест один раз в месяц:
#   В пятницу (5-й день) с 14 по 20 число месяца, между 22-23 часов. Это вторая или третья пятница месяца.
#
# РАСКОМЕНТИРОВАТЬ ПОСЛЕ ПРОВЕРКИ ОТПРАВКИ ПИСЕМ (выше)
DEVICESCAN -o on -S on -a -s (S/../.././02|L/../(14|15|16|17|18|19|20)/5/22) -m alerts@ztime.ru -M exec /usr/share/smartmontools/smartd-runner -M diminishing


# Описание работы и синтаксис:
# -o on – Включение SMART Automatic Offline тестов для обновления статуса атрибутов
# -S on – включение автосохранения атрибутов. #   -S VAL  Enable/disable attribute autosave (on/off)
# -a – включает набор опций –H (Проверить только здоровье диска (если значение Prefailure атрибута меньше за threshold – увидим, что диск не здоров)), -f (мониторинг наличия ошибок в атрибутах), -t (включение опций -u и -p), -l error -l selftest (проверяется журнал ошибок и пройденных тестов) –С 197 (сообщать, если кол-во Pending Sector не равно нулю) –U 198 (сообщать,если кол-во Offline Uncorrectable секторов не равно нулю)
#
# ОПИСАНИЕ ПАРАМЕТРА -s . НАЧАЛО
# -s – запуск самотестирования когда тип тестирования и дата совпадают с регулярным вывражением
# - Выполнять короткий тест каждый день между 2-3 ночи. 
# - Выполнять полный тест один раз в месяц:
#   В пятницу (5-й день) с 14 по 20 число месяца, между 22-23 часов. Это вторая или третья пятница месяца.
#
# Синтаксис:
# T/MM/DD/d/HH. 
# Важно!  MM, DD, HH - пишем ОБЯЗАТЕЛЬНО ДВЕ цифры!!! не 1, а 01!! Иначе выражение всегда будет ложным и тесты не будут выполняться. При этом правильность синтсксиса конфига будет говорить, что все в порядке!
# d - всегда ОДНА цифра. 1 - Понедельник. 7 - Воскресенье.
# ОПИСАНИЕ ПАРАМЕТРА -s . КОНЕЦ
#
# -m — кому отправлять письма о проблеме
# -M exec  – модифицировать E-mail-сообщение перед отправкой
# В данном случае запускается скрипт /usr/share/smartmontools/smartd-runner , в него подставлюятся нужные значения, на выходе получаем готовое сообщение
# Если такого скрита нет, то необходимо отключить эту опцию
# Демон smartd будет ждать, пока скрипт не завершит свою работу. Эта опция полезна, когда нужно провести некие действия с сообщением или выбрать другой почтовый клиент (по умолчанию /usr/bin/mail).
# Так в Debian smartd-runner будет запускать каждый скрипт в /etc/smartmontools/run.d/, один из которых и отправляет сообщение адресату, указанному в опции “-m”.

# -M test Для тестировния отправки сообщения добавляем опцию -M test которая позволяет отправить тестовое письмо при старте демона smartd.
# -M diminishing - периодически повторять отправку письма с сообщениями об ошибке;
# которая постоянно напоминает об ошибке (через каждых 2*N дней, т.е. 1-го числа, второго, четвертого, восьмого и т.д.), по умолчанию(если эта опция отключена) письмо о проблеме придет только один раз

### ВАЖНО! Если в конфиге используется DEVICESCAN, то все строки идущие после игнорируются!!! Т.е. в конфиге должен быть ОДИН DEVICESCAN, в эту строку вписываем все нужные опции.






# smartd will re-read the configuration file if it receives a HUP
# signal

# The file gives a list of devices to monitor using smartd, with one
# device per line. Text after a hash (#) is ignored, and you may use
# spaces and tabs for white space. You may use '\' to continue lines.

# You can usually identify which hard disks are on your system by
# looking in /proc/ide and in /proc/scsi.

# The word DEVICESCAN will cause any remaining lines in this
# configuration file to be ignored: it tells smartd to scan for all
# ATA and SCSI devices.  DEVICESCAN may be followed by any of the
# Directives listed below, which will be applied to all devices that
# are found.  Most users should comment out DEVICESCAN and explicitly
# list the devices that they wish to monitor.
DEVICESCAN -d removable -n standby -m root -M exec /usr/share/smartmontools/smartd-runner

# Alternative setting to ignore temperature and power-on hours reports
# in syslog.
#DEVICESCAN -I 194 -I 231 -I 9

# Alternative setting to report more useful raw temperature in syslog.
#DEVICESCAN -R 194 -R 231 -I 9

# Alternative setting to report raw temperature changes >= 5 Celsius
# and min/max temperatures.
#DEVICESCAN -I 194 -I 231 -I 9 -W 5

# First ATA/SATA or SCSI/SAS disk.  Monitor all attributes, enable
# automatic online data collection, automatic Attribute autosave, and
# start a short self-test every day between 2-3am, and a long self test
# Saturdays between 3-4am.
#/dev/sda -a -o on -S on -s (S/../.././02|L/../../6/03)

# Monitor SMART status, ATA Error Log, Self-test log, and track
# changes in all attributes except for attribute 194
#/dev/sdb -H -l error -l selftest -t -I 194

# Monitor all attributes except normalized Temperature (usually 194),
# but track Temperature changes >= 4 Celsius, report Temperatures
# >= 45 Celsius and changes in Raw value of Reallocated_Sector_Ct (5).
# Send mail on SMART failures or when Temperature is >= 55 Celsius.
#/dev/sdc -a -I 194 -W 4,45,55 -R 5 -m admin@example.com

# An ATA disk may appear as a SCSI device to the OS. If a SCSI to
# ATA Translation (SAT) layer is between the OS and the device then
# this can be flagged with the '-d sat' option. This situation may
# become common with SATA disks in SAS and FC environments.
# /dev/sda -a -d sat

# A very silent check.  Only report SMART health status if it fails
# But send an email in this case
#/dev/sdc -H -C 0 -U 0 -m admin@example.com

# First two SCSI disks.  This will monitor everything that smartd can
# monitor.  Start extended self-tests Wednesdays between 6-7pm and
# Sundays between 1-2 am
#/dev/sda -d scsi -s L/../../3/18
#/dev/sdb -d scsi -s L/../../7/01

# Monitor 4 ATA disks connected to a 3ware 6/7/8000 controller which uses
# the 3w-xxxx driver. Start long self-tests Sundays between 1-2, 2-3, 3-4, 
# and 4-5 am.
# NOTE: starting with the Linux 2.6 kernel series, the /dev/sdX interface
# is DEPRECATED.  Use the /dev/tweN character device interface instead.
# For example /dev/twe0, /dev/twe1, and so on.
#/dev/sdc -d 3ware,0 -a -s L/../../7/01
#/dev/sdc -d 3ware,1 -a -s L/../../7/02
#/dev/sdc -d 3ware,2 -a -s L/../../7/03
#/dev/sdc -d 3ware,3 -a -s L/../../7/04

# Monitor 2 ATA disks connected to a 3ware 9000 controller which
# uses the 3w-9xxx driver (Linux, FreeBSD). Start long self-tests Tuesdays
# between 1-2 and 3-4 am.
#/dev/twa0 -d 3ware,0 -a -s L/../../2/01
#/dev/twa0 -d 3ware,1 -a -s L/../../2/03

# Monitor 2 SATA (not SAS) disks connected to a 3ware 9000 controller which
# uses the 3w-sas driver (Linux). Start long self-tests Tuesdays
# between 1-2 and 3-4 am.
# On FreeBSD /dev/tws0 should be used instead
#/dev/twl0 -d 3ware,0 -a -s L/../../2/01
#/dev/twl0 -d 3ware,1 -a -s L/../../2/03

# Same as above for Windows. Option '-d 3ware,N' is not necessary,
# disk (port) number is specified in device name.
# NOTE: On Windows, DEVICESCAN works also for 3ware controllers.
#/dev/hdc,0 -a -s L/../../2/01
#/dev/hdc,1 -a -s L/../../2/03
#
# Monitor 2 disks connected to the first HP SmartArray controller which
# uses the cciss driver. Start long tests on Sunday nights and short
# self-tests every night and send errors to root
#/dev/cciss/c0d0 -d cciss,0 -a -s (L/../../7/02|S/../.././02) -m root
#/dev/cciss/c0d0 -d cciss,1 -a -s (L/../../7/03|S/../.././03) -m root

# Monitor 3 ATA disks directly connected to a HighPoint RocketRAID. Start long
# self-tests Sundays between 1-2, 2-3, and 3-4 am. 
#/dev/sdd -d hpt,1/1 -a -s L/../../7/01
#/dev/sdd -d hpt,1/2 -a -s L/../../7/02
#/dev/sdd -d hpt,1/3 -a -s L/../../7/03

# Monitor 2 ATA disks connected to the same PMPort which connected to the
# HighPoint RocketRAID. Start long self-tests Tuesdays between 1-2 and 3-4 am
#/dev/sdd -d hpt,1/4/1 -a -s L/../../2/01
#/dev/sdd -d hpt,1/4/2 -a -s L/../../2/03

# HERE IS A LIST OF DIRECTIVES FOR THIS CONFIGURATION FILE.
# PLEASE SEE THE smartd.conf MAN PAGE FOR DETAILS
#
#   -d TYPE Set the device type: ata, scsi, marvell, removable, 3ware,N, hpt,L/M/N
#   -T TYPE set the tolerance to one of: normal, permissive
#   -o VAL  Enable/disable automatic offline tests (on/off)
#   -S VAL  Enable/disable attribute autosave (on/off)
#   -n MODE No check. MODE is one of: never, sleep, standby, idle
#   -H      Monitor SMART Health Status, report if failed
#   -l TYPE Monitor SMART log.  Type is one of: error, selftest
#   -f      Monitor for failure of any 'Usage' Attributes
#   -m ADD  Send warning email to ADD for -H, -l error, -l selftest, and -f
#   -M TYPE Modify email warning behavior (see man page)
#   -s REGE Start self-test when type/date matches regular expression (see man page)
#   -p      Report changes in 'Prefailure' Normalized Attributes
#   -u      Report changes in 'Usage' Normalized Attributes
#   -t      Equivalent to -p and -u Directives
#   -r ID   Also report Raw values of Attribute ID with -p, -u or -t
#   -R ID   Track changes in Attribute ID Raw value with -p, -u or -t
#   -i ID   Ignore Attribute ID for -f Directive
#   -I ID   Ignore Attribute ID for -p, -u or -t Directive
#   -C ID   Report if Current Pending Sector count non-zero
#   -U ID   Report if Offline Uncorrectable count non-zero
#   -W D,I,C Monitor Temperature D)ifference, I)nformal limit, C)ritical limit
#   -v N,ST Modifies labeling of Attribute N (see man page)
#   -a      Default: equivalent to -H -f -t -l error -l selftest -C 197 -U 198
#   -F TYPE Use firmware bug workaround. Type is one of: none, samsung
#   -P TYPE Drive-specific presets: use, ignore, show, showall
#    #      Comment: text after a hash sign is ignored
#    \      Line continuation character
# Attribute ID is a decimal integer 1 <= ID <= 255
# except for -C and -U, where ID = 0 turns them off.
# All but -d, -m and -M Directives are only implemented for ATA devices
#
# If the test string DEVICESCAN is the first uncommented text
# then smartd will scan for devices.
# DEVICESCAN may be followed by any desired Directives.
